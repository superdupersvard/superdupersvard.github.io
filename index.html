<!DOCTYPE html>
<html>
    <head>
    <title>MTB-O Kartan</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv='imagetoolbar' content='no'/>
    <style type="text/css"> v\:* {behavior:url(#default#VML);}
        html, body { overflow: hidden; padding: 0; height: 100%; width: 100%; font-family: 'Lucida Grande',Geneva,Arial,Verdana,sans-serif; }
        body { margin: 10px; background: #fff; }
        h1 { margin: 0; padding: 6px; border:0; font-size: 20pt; }
        #header { height: 43px; padding: 0; background-color: #eee; border: 1px solid #888; display: flex; align-items: center; justify-content: flex-start; gap: 20px;}
        #header h1 { margin: 0; padding: 6px; border: 0; font-size: 20pt; flex: none; }
        #subheader { height: 12px; text-align: right; font-size: 10px; color: #555;}
        #map { height: 90%; border: 1px solid #888; }
        #export-btn.pressed { background: #0074d9; color: white; border: 2px solid #005fa3; }
        #config-panel label { display: block; margin-bottom: 10px; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.css" type="text/css">
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@main/dist/en/v7.0.0/legacy/ol.js"></script>
    <script src="https://unpkg.com/ol-layerswitcher@4.1.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/proj4@2.9.0/dist/proj4.js"></script>
    <script type="module" src="main.js"></script>
    <script>
        // Register EPSG:3006 with OpenLayers
        proj4.defs("EPSG:3006","+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");
        if (window.ol && ol.proj && ol.proj.proj4) {
            ol.proj.proj4.register(proj4);
        }
    </script>
    <link rel="stylesheet" href="https://unpkg.com/ol-layerswitcher@4.1.1/src/ol-layerswitcher.css" />
    <style>
        .opacity-slider {
            position: absolute;
            top: 70px;
            right: 0px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        .trail-popup-entry {
            cursor: pointer;
            color: #0074d9;
            margin: 2px 0;
        }
        .trail-popup-entry:hover {
            text-decoration: underline;
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>MTB-O Kartan</h1>
        <button id="export-btn" style="margin-left:20px;">Export</button>
        <div id="export-config" style="display:none; margin-left:20px; gap:10px; align-items:center;">
            <label for="north-align">North-align:</label>
            <select id="north-align">
                <option value="magnetic">Magnetic</option>
                <option value="grid">Grid</option>
            </select>
            <label for="scale-select">Scale:</label>
            <select id="scale-select">
                <option value="7500">1:7 500</option>
                <option value="10000">1:10 000</option>
                <option value="15000">1:15 000</option>
                <option value="custom">Custom</option>
            </select>
            <span id="custom-scale-prefix" style="display:none;">1:</span>
            <input type="number" id="custom-scale" placeholder="Enter scale" style="width:90px; display:none;" min="1000" step="100">
            <label for="paper-select">Paper size:</label>
            <select id="paper-select">
                <option value="A4">A4 (297×210 mm)</option>
                <option value="A3">A3 (420×297 mm)</option>
                <option value="A2">A2 (594×420 mm)</option>
            </select>
            <label for="orientation-select">Orientation:</label>
            <select id="orientation-select">
                <option value="portrait">Portrait</option>
                <option value="landscape">Landscape</option>
            </select>
            <label for="Format" style="font-size: 0.85em; margin-bottom: 2px;">Format:</label>
            <select id="format-select">
                <option value="tif">GeoTIFF</option>
                <option value="png">PNG</option>
                <option value="jpg">JPEG</option>
                <option value="omap">OMAP</option>
            </select>
            <button id="open-config-btn" style="margin-left:20px;">⚙️ Config</button>
            <button id="generate-map-btn" style="margin-left:20px;">Generate Map</button>
        </div>
    </div>
    <div id="subheader">Generated by <a href="https://gdal.org/programs/gdal2tiles.html">GDAL2Tiles</a>&nbsp;&nbsp;&nbsp;&nbsp;</div>
    <div id="loading-indicator" style="display: none; position: fixed;
        top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5);
        z-index: 9999; color: white; font-size: 2em; text-align: center; padding-top: 20%;">
        Generating map, please wait...
    </div>
    <div id="config-panel" style="display:none; position:fixed; top:20%; left:50%; transform:translate(-50%, 0); background:white; border:1px solid #ccc; padding:20px; z-index:10000; box-shadow:0 2px 8px rgba(0,0,0,0.2);">
        <h3>Map Configuration</h3>
        <label for="contour-interval">Contour Interval:
        <select id="contour-interval">
            <option value="10">10</option>
            <option value="5">5</option>
            <option value="2.5">2.5</option>
        </select>
        </label>
        <br>
        <label>
            Include Topo10 Path
            <input type="checkbox" id="topo10-path" checked>
        </label>
        <br>
        <label>OSM Layers:
            <input type="text" id="osm-layers" value="417 418 419">
            <small>(space-separated)</small>
        </label>
        <br><br>
        <button id="config-save-btn">Save</button>
        <button id="config-cancel-btn">Cancel</button>
    </div>
    <div id="map" class="map"></div>
    <div class="opacity-slider" id="opacity-slider" style="display:none;">
        <label for="opacity">Trail Opacity:</label>
        <input type="range" id="opacity" name="opacity" min="0.25" max="1" step="0.1" value="0.75">
    </div>
    <div id="mouse-position"></div>
</body>
</html>